# 百度竞价关键词商业价值验证工具

## 📋 工具概述

这是 NicheMiner 项目生态中的一个独立工具，用于验证关键词的商业价值。通过批量检测百度搜索结果中是否出现广告，来判断关键词是否值得重点关注。

**使用场景**: 当你通过 NicheMiner 筛选出潜在的关键词后，可以使用这个工具验证哪些关键词有同行在投放广告，从而进一步确认其商业价值。

---

## 🎯 核心功能

### 主要特性

1. **批量验证**: 一次性处理 Excel 中的数千个关键词
2. **广告检测**: 自动识别百度搜索结果中的"广告"标识
3. **信息提取**: 提取广告标题和链接（前3个），方便分析同行
4. **截图保存**: 自动保存有广告的关键词截图，方便人工复核
5. **防封策略**: 随机等待、真实 User-Agent，降低被封风险
6. **异常处理**: 单个关键词失败不影响整体流程

### 工作原理

```
关键词列表 → 批量搜索 → 检测广告标识 → 提取信息 → 保存结果
```

1. 读取 Excel 文件中的关键词列表
2. 使用 Playwright 自动化浏览器访问百度搜索
3. 逐个搜索关键词
4. 检测搜索结果中是否包含"广告"或"推广"标识
5. 如果发现广告，提取标题和链接，并保存截图
6. 将所有结果汇总保存到新的 Excel 文件

---

## 🚀 快速开始

### 安装依赖

```bash
# 1. 安装 Python 包
pip install -r requirements.txt

# 2. 安装 Playwright 浏览器
playwright install chromium
```

### 准备数据

1. 准备 Excel 文件 `keywords.xlsx`
2. 确保文件中有一列名为 `Keyword`（包含要验证的关键词）

示例 Excel 结构：

| Keyword |
|---------|
| 野生黄芪多少钱 |
| 黄芪的功效与作用 |
| 哪里买黄芪 |

### 运行工具

```bash
# 基本使用（显示浏览器窗口）
python baidu_ad_validator.py

# 无头模式（后台运行）
python baidu_ad_validator.py --headless
```

---

## 📊 输出结果

### Excel 结果文件

默认输出文件: `keywords_validated.xlsx`

包含以下新增列：

- **Has_Ads**: 是否有广告（Yes/No/Error）
- **Ad_Titles**: 广告标题列表（最多3个，用 ` | ` 分隔）
- **Ad_Links**: 广告链接列表（最多3个，用 ` | ` 分隔）

示例：

| Keyword | Has_Ads | Ad_Titles | Ad_Links |
|---------|---------|-----------|----------|
| 野生黄芪多少钱 | Yes | 野生黄芪价格_正品批发 | https://example.com |
| 黄芪的功效 | No | | |

### 截图文件

如果有广告的关键词，会在 `screenshots/` 目录保存对应的截图（PNG 格式），方便人工复核。

---

## 🔧 使用技巧

### 与 NicheMiner 工作流程结合

1. **第一步**: 使用 NicheMiner 导入并筛选关键词
2. **第二步**: 导出筛选后的关键词为 Excel
3. **第三步**: 使用本工具验证这些关键词是否有广告
4. **第四步**: 重点关注有广告的关键词（同行已验证商业价值）

### 命令行参数

```bash
# 完整参数示例
python baidu_ad_validator.py \
  -i keywords.xlsx \           # 输入文件
  -o validated.xlsx \          # 输出文件
  -c Keyword \                 # 关键词列名
  --screenshots screenshots \  # 截图目录
  --headless                   # 无头模式
```

### 参数说明

| 参数 | 简写 | 默认值 | 说明 |
|------|------|--------|------|
| `--input` | `-i` | `keywords.xlsx` | 输入 Excel 文件路径 |
| `--output` | `-o` | `keywords_validated.xlsx` | 输出 Excel 文件路径 |
| `--column` | `-c` | `Keyword` | 关键词列名 |
| `--headless` | - | `False` | 无头模式运行 |
| `--screenshots` | `-s` | `screenshots` | 截图保存目录 |

---

## ⚙️ 技术实现

### 技术栈

- **Python 3.x**: 编程语言
- **Playwright**: 浏览器自动化（比 Selenium 更快更稳）
- **Pandas**: 数据处理
- **OpenPyXL**: Excel 文件读写

### 核心代码结构

```
baidu_ad_validator.py
├── BaiduAdValidator 类
│   ├── search_keyword()      # 搜索关键词
│   ├── detect_ads()          # 检测广告
│   └── validate_keyword()    # 验证单个关键词
├── load_keywords_from_excel() # 加载关键词
├── save_results_to_excel()    # 保存结果
└── main()                     # 主函数
```

### 广告检测逻辑

1. **方法1**: 查找包含"广告"文本的 span 或标签
2. **方法2**: 查找带有特定 class 的广告结果容器（`.c-container`）
3. **方法3**: 遍历搜索结果项，检查内部是否包含"广告"或"推广"标识

检测到广告后：
- 提取标题（`h3 a` 或 `.t a`）
- 提取链接（`a[href]`）
- 处理百度跳转链接
- 只取前3个广告的信息

### 防封策略

- ✅ **随机等待**: 每次搜索之间随机等待 2-5 秒
- ✅ **真实 User-Agent**: 使用真实的 PC 端浏览器标识
- ✅ **自动化特征隐藏**: 禁用自动化检测特征
- ✅ **操作延迟**: 搜索、点击等操作之间都有适当延迟

---

## ⚠️ 注意事项

### 使用建议

1. **频率控制**: 不要过于频繁运行，避免被百度检测为机器人
2. **网络环境**: 确保网络连接稳定
3. **数据量**: 建议每次处理不超过 5000 个关键词
4. **分批处理**: 如果关键词很多，可以分批处理，避免程序运行时间过长

### 常见问题

**Q: 检测不到广告，但手动搜索能看到？**
A: 可能是页面加载时间不够，或百度页面结构变化。检查截图文件，或尝试增加等待时间。

**Q: 程序运行很慢？**
A: 这是正常的，因为每个关键词需要 2-5 秒等待时间。如果关键词很多，建议使用无头模式或分批处理。

**Q: 如何中断程序？**
A: 按 `Ctrl+C` 可以中断，但只有程序正常结束时才会保存结果。

### 限制说明

- 依赖百度页面结构，如果百度改版可能需要更新代码
- 受百度反爬机制影响，过于频繁可能被封
- 广告检测准确率取决于页面加载完整度

---

## 🔄 更新日志

### v1.0.0 (2024-12-24)

- ✅ 初始版本发布
- ✅ 支持批量关键词验证
- ✅ 广告检测和信息提取
- ✅ 截图保存功能
- ✅ Excel 结果导出
- ✅ 防封策略实现

---

## 📝 相关文档

- [项目总体说明](./项目说明.md)
- [工具使用说明](../README_BAIDU_VALIDATOR.md)

---

**维护者**: NicheMiner 开发团队  
**最后更新**: 2024-12-24

