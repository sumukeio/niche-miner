# NicheMiner 项目重构说明

## 📋 重构概述

本次重构将NicheMiner从单流程应用改造成了多项目工作台模式，并添加了硅谷风格的落地页。

## 🎯 主要变更

### 1. 页面结构重组

#### 新的路由结构

```
/ (首页 - 落地页)
├── /dashboard (工作台 - 项目列表)
├── /project/[id] (项目详情 - 三步流程)
│   ├── Step 1: 导入
│   ├── Step 2: 智能清洗
│   └── Step 3: 选品看板
├── /ad-validator (广告验证工具)
├── /login (登录页面 - 待开发)
└── /register (注册页面 - 待开发)
```

### 2. 新增功能

#### 硅谷风格落地页 (`/`)
- **设计特点**：
  - 渐变背景和现代UI设计
  - 清晰的Hero区域展示产品价值
  - 6个功能特性卡片
  - 三步工作流程说明
  - 行动号召(CTA)区域
  
- **功能说明**：
  - 介绍长尾词清洗功能
  - 介绍广告验证工具
  - 提供"开始使用"和"广告验证工具"入口
  - 右上角登录/注册按钮（功能待开发）

#### 工作台页面 (`/dashboard`)
- **功能**：
  - 展示所有项目列表
  - 每个项目显示：
    - 项目名称
    - 创建日期
    - 关键词数量
    - 删除按钮（悬停显示）
  - 顶部大按钮上传文件创建新项目
  - 支持CSV、XLSX、XLS格式
  - 点击项目卡片进入项目详情

#### 项目详情页面 (`/project/[id]`)
- **功能**：
  - 保留原有的三步流程
  - 智能判断项目状态，自动进入对应步骤
  - 支持返回到工作台
  - 顶部显示项目名称和ID
  - 步骤指示器显示当前位置

### 3. 文件格式支持扩展

#### StepImport组件升级
- **新增支持**：
  - ✅ CSV格式（原有）
  - ✅ XLSX格式（新增）
  - ✅ XLS格式（新增）

- **技术实现**：
  - 使用`xlsx`库解析Excel文件
  - 使用`papaparse`解析CSV文件
  - 统一的数据处理逻辑
  - 智能识别表头行（前5行查找"关键词"列）

### 4. 组件接口调整

#### StepImport组件
```typescript
interface StepImportProps {
  onNext: (projectId?: string) => void
  projectId?: string  // 可选：如果提供，使用现有项目；否则创建新项目
}
```

- **使用场景1**：工作台上传文件
  - 不提供`projectId`
  - 创建新项目后跳转到项目详情页
  
- **使用场景2**：项目详情页导入
  - 提供`projectId`
  - 直接在现有项目中导入数据

## 🔄 工作流程

### 用户使用流程

```
1. 访问首页 (/)
   ↓
2. 点击"开始使用"或直接访问 /dashboard
   ↓
3. 在工作台上传文件创建项目
   ↓
4. 自动跳转到项目详情页 (/project/[id])
   ↓
5. 完成三步流程：
   - Step 1: 导入数据（如果还没导入）
   - Step 2: 智能清洗
   - Step 3: 选品看板
   ↓
6. 可以随时返回工作台查看所有项目
```

### 数据流程

```
上传文件
  ↓
创建项目记录 (projects表)
  ↓
解析文件（CSV/XLSX/XLS）
  ↓
批量插入关键词 (keywords表)
  ↓
项目详情页自动检测：
  - 如果有关键词 → 进入Step 2（清洗）
  - 如果有valid关键词 → 进入Step 3（看板）
  - 如果没关键词 → 停留在Step 1（导入）
```

## 📁 文件变更清单

### 新增文件
- `src/app/page.tsx` - 硅谷风格落地页
- `src/app/dashboard/page.tsx` - 工作台页面
- `src/app/project/[id]/page.tsx` - 项目详情页
- `src/app/login/page.tsx` - 登录页面（占位符）
- `src/app/register/page.tsx` - 注册页面（占位符）
- `docs/项目重构说明.md` - 本文档

### 修改文件
- `src/app/components/StepImport.tsx` - 支持Excel格式和可选projectId
- `.gitignore` - 添加temp目录忽略

## 🎨 UI/UX 改进

### 设计风格
- **落地页**：硅谷风格，渐变背景，大字体，清晰层次
- **工作台**：卡片式布局，悬停效果，清晰的项目信息展示
- **项目详情**：保留原有设计，添加导航和项目信息

### 交互优化
- 工作台项目卡片支持悬停删除
- 智能步骤跳转（根据项目状态）
- 清晰的导航路径（返回按钮、工作台链接）
- 实时加载状态提示

## 🔧 技术细节

### 文件解析

#### CSV文件
```typescript
Papa.parse<string[]>(file, {
  header: false,
  skipEmptyLines: true,
  encoding: 'GB18030'
})
```

#### Excel文件
```typescript
const workbook = XLSX.read(data, { type: 'array' })
const firstSheet = workbook.Sheets[workbook.SheetNames[0]]
const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 })
```

### 项目状态检测

项目详情页会自动检测项目状态：

```typescript
// 检查是否有关键词
const { count } = await supabase
  .from('keywords')
  .select('*', { count: 'exact', head: true })
  .eq('project_id', projectId)

// 检查是否有valid状态的关键词
const { count: validCount } = await supabase
  .from('keywords')
  .select('*', { count: 'exact', head: true })
  .eq('project_id', projectId)
  .eq('status', 'valid')

// 根据状态决定显示哪个步骤
if (validCount > 0) {
  setCurrentStep(3) // 直接进入看板
} else if (count > 0) {
  setCurrentStep(2) // 进入清洗步骤
} else {
  setCurrentStep(1) // 停留在导入步骤
}
```

## 📦 依赖更新

### 新增依赖
- `xlsx@0.18.5` - Excel文件解析（已在package.json中）

### 无需额外安装
- `papaparse` - CSV解析（已存在）
- `lucide-react` - 图标库（已存在）

## ⚠️ 注意事项

### 数据库
- 确保`projects`表和`keywords`表有正确的关联
- 建议设置级联删除：删除项目时自动删除相关关键词

### 文件上传限制
- 当前没有设置文件大小限制（建议根据实际需求添加）
- 支持的文件格式：`.csv`, `.xlsx`, `.xls`

### 待开发功能
- 登录/注册功能（目前是占位符页面）
- 用户认证和权限管理
- 项目分享功能
- 批量操作功能

## 🚀 下一步计划

1. **用户系统**
   - 实现登录/注册功能
   - 用户数据隔离
   - 项目权限管理

2. **功能增强**
   - 项目重命名
   - 项目复制
   - 项目归档
   - 批量删除

3. **性能优化**
   - 项目列表分页
   - 关键词数量缓存
   - 文件上传进度优化

---

**最后更新**: 2024-12-24


