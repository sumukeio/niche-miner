# 商业意图打分功能设计文档

## 📋 功能概述

在现有分词清洗模块基础上，增加**商业意图自动打分**功能，帮助用户快速识别具有高商业价值的关键词。

## 🎯 核心需求

### 评分规则

**高分词（商业意图强，+10分/词）**：
- 多少钱、价格、多少钱一斤、报价
- 厂家、供应商、生产厂家
- 批发、批发价、批发市场
- 功效、副作用、作用
- 哪里买、哪里有卖、购买
- 品牌、牌子、哪个牌子好

**低分词（信息查询，-5分/词）**：
- 是什么、什么意思、是什么东西
- 图片、高清图片、图片大全
- 怎么做、做法、制作方法
- 能吃吗、可以吃吗
- 和...的区别、有什么区别

**评分逻辑**：
- 初始分数：50分（中性）
- 找到高分词：+10分/词（可累计）
- 找到低分词：-5分/词（可累计）
- 最终分数范围：0-100分

## 🏗️ 实现方案

### 方案1：在导入时计算（推荐）

**优点**：
- 数据入库时就带分数，无需后续计算
- 看板和导出时可直接使用
- 性能好，一次计算永久使用

**实现位置**：`StepImport.tsx`

**代码示例**：
```typescript
// 在导入时计算商业意图分
const calculateBusinessIntentScore = (term: string): number => {
  const highIntentWords = ['多少钱', '价格', '厂家', '批发', '功效', '副作用', '哪里买', '购买', '品牌']
  const lowIntentWords = ['是什么', '图片', '怎么做', '能吃吗', '区别']
  
  let score = 50 // 初始分数
  
  // 检查高分词
  highIntentWords.forEach(word => {
    if (term.includes(word)) {
      score += 10
    }
  })
  
  // 检查低分词
  lowIntentWords.forEach(word => {
    if (term.includes(word)) {
      score -= 5
    }
  })
  
  // 限制分数范围 0-100
  return Math.max(0, Math.min(100, score))
}

// 在导入数据时添加
return {
  project_id: projectId,
  term: term.trim(),
  pc_volume: pcVol,
  mobile_volume: mobVol,
  search_volume: pcVol + mobVol,
  competition: parseNum(getVal('竞价竞争激烈程度(VIP特权数据)')),
  status: 'pending',
  business_intent_score: calculateBusinessIntentScore(term.trim()) // 新增字段
}
```

### 方案2：在清洗时计算（备选）

**优点**：
- 可以结合分词结果，更精确
- 可以实时调整评分规则

**缺点**：
- 需要批量更新已有数据
- 性能较差

### 方案3：可配置的评分规则（高级）

**实现思路**：
- 在数据库中存储评分规则配置表
- 用户可以在界面中自定义高分词和低分词
- 支持每个词不同的分数权重

## 📊 数据库变更

### 1. keywords 表增加字段

```sql
ALTER TABLE keywords 
ADD COLUMN business_intent_score INTEGER DEFAULT 50;

-- 添加索引以便排序
CREATE INDEX idx_keywords_business_intent_score 
ON keywords(project_id, business_intent_score DESC);
```

### 2. 可选：评分规则配置表

```sql
CREATE TABLE intent_scoring_rules (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  project_id UUID REFERENCES projects(id),
  word VARCHAR(100) NOT NULL,
  score INTEGER NOT NULL,  -- 正数为高分词，负数为低分词
  type VARCHAR(20) NOT NULL, -- 'high' 或 'low'
  created_at TIMESTAMP DEFAULT NOW()
);

-- 默认规则可以预填充
INSERT INTO intent_scoring_rules (project_id, word, score, type) VALUES
(NULL, '多少钱', 10, 'high'),
(NULL, '价格', 10, 'high'),
(NULL, '厂家', 10, 'high'),
(NULL, '批发', 10, 'high'),
(NULL, '是什么', -5, 'low'),
(NULL, '图片', -5, 'low'),
(NULL, '怎么做', -5, 'low');
-- project_id 为 NULL 表示全局默认规则
```

## 🎨 UI 改进方案

### 1. StepRules 组件增强

在特征词卡片上显示商业意图分数（如果关键词包含该词）：

```typescript
// 计算特征词的平均商业意图分
const calculateTokenIntentScore = (token: string, samples: any[]) => {
  const matchingTerms = samples.filter(s => s.term.includes(token))
  if (matchingTerms.length === 0) return 50
  
  const avgScore = matchingTerms.reduce((sum, s) => sum + (s.business_intent_score || 50), 0) / matchingTerms.length
  return Math.round(avgScore)
}
```

**UI 展示**：
```
┌─────────────────────┐
│ 黄芪                │
│ 出现: 1234 次       │
│ 商业意图: 75分 🟢   │  ← 新增
│                     │
│ [是产品] [垃圾]     │
└─────────────────────┘
```

### 2. StepDashboard 组件增强

#### 2.1 排序选项

增加按商业意图分排序的选项：

```typescript
const [sortBy, setSortBy] = useState<'blue_ocean' | 'business_intent' | 'search_volume'>('blue_ocean')

// 排序逻辑
const sortedKeywords = useMemo(() => {
  if (sortBy === 'business_intent') {
    return [...topKeywords].sort((a, b) => (b.business_intent_score || 50) - (a.business_intent_score || 50))
  } else if (sortBy === 'blue_ocean') {
    return [...topKeywords].sort((a, b) => (b.blue_ocean_score || 0) - (a.blue_ocean_score || 0))
  }
  return topKeywords
}, [topKeywords, sortBy])
```

#### 2.2 综合评分

结合蓝海分和商业意图分计算综合评分：

```typescript
const calculateComprehensiveScore = (keyword: KeywordData): number => {
  const blueOceanScore = keyword.blue_ocean_score || 0
  const businessIntentScore = keyword.business_intent_score || 50
  
  // 归一化蓝海分（假设最大值为1000）
  const normalizedBlueOcean = Math.min(blueOceanScore / 10, 100)
  
  // 加权平均：商业意图分权重40%，蓝海分权重60%
  return Math.round(normalizedBlueOcean * 0.6 + businessIntentScore * 0.4)
}
```

#### 2.3 筛选器

增加商业意图分筛选：

```typescript
const [minIntentScore, setMinIntentScore] = useState(60) // 只显示商业意图分 >= 60 的

const filteredKeywords = sortedKeywords.filter(k => 
  (k.business_intent_score || 50) >= minIntentScore
)
```

#### 2.4 表格列

在 Top 100 榜单中增加商业意图分列：

```typescript
<th>排名</th>
<th>关键词</th>
<th>日搜索量</th>
<th>竞争度</th>
<th>蓝海分</th>
<th>商业意图分</th>  {/* 新增 */}
<th>综合分</th>      {/* 可选 */}
```

### 3. 导出功能增强

在 CSV 导出时包含商业意图分：

```typescript
return {
  '排名': rankCounter++,
  '关键词': row.term,
  '日搜索量': row.search_volume,
  '竞争度': row.competition,
  '蓝海分': score,
  '商业意图分': row.business_intent_score || 50,  // 新增
  'PC流量': row.pc_volume,
  '移动流量': row.mobile_volume
}
```

## 🔄 工作流程

### 完整流程

```
1. 导入数据
   └─→ 自动计算商业意图分
       └─→ 存入数据库

2. 智能清洗
   └─→ 显示特征词的商业意图分（平均值）
       └─→ 辅助用户判断

3. 选品看板
   └─→ 可按商业意图分排序
       └─→ 显示商业意图分
       └─→ 可筛选高分关键词
       └─→ 导出包含商业意图分
```

## 🛠️ 实现步骤

### 第一阶段：基础功能

1. ✅ 在数据库增加 `business_intent_score` 字段
2. ✅ 实现评分函数（硬编码规则）
3. ✅ 在导入时计算并保存分数
4. ✅ 在 Dashboard 显示商业意图分
5. ✅ 在导出时包含商业意图分

### 第二阶段：UI 增强

1. ✅ 在 StepRules 显示特征词的平均商业意图分
2. ✅ 在 Dashboard 增加排序选项
3. ✅ 增加筛选功能
4. ✅ 增加综合评分

### 第三阶段：可配置（可选）

1. ⏳ 创建评分规则配置表
2. ⏳ UI 界面管理评分规则
3. ⏳ 支持项目级别的自定义规则
4. ⏳ 规则导入/导出功能

## 💡 评分规则优化建议

### 更精确的匹配

使用正则表达式或更智能的匹配：

```typescript
const highIntentPatterns = [
  /多少钱|价格|报价|售价/i,
  /厂家|供应商|生产厂家|制造商/i,
  /批发|批发价|批发市场/i,
  /功效|作用|副作用|效果/i,
  /哪里买|哪里有卖|购买|选购/i,
  /品牌|牌子|哪个牌子|什么牌子/i,
]

const lowIntentPatterns = [
  /是什么|什么意思|是什么东西/i,
  /图片|高清图片|图片大全|壁纸/i,
  /怎么做|做法|制作方法|如何做/i,
  /能吃吗|可以吃吗|能不能吃/i,
  /区别|和.*的区别|有什么不同/i,
]
```

### 加权评分

不同词的权重可以不同：

```typescript
const scoringRules = {
  high: {
    '多少钱': 15,  // 商业意图最强
    '价格': 15,
    '厂家': 12,
    '批发': 12,
    '功效': 10,
    '购买': 10,
  },
  low: {
    '是什么': -8,
    '图片': -8,
    '怎么做': -5,
    '能吃吗': -5,
  }
}
```

## 📈 预期效果

1. **提升筛选效率**：用户可以快速识别高商业价值关键词
2. **减少人工判断**：商业意图分辅助决策
3. **更好的排序**：结合蓝海分和商业意图分的综合排序
4. **数据驱动**：基于关键词内容自动评分，客观准确

## 🔍 示例

### 示例关键词评分

| 关键词 | 商业意图分 | 说明 |
|--------|-----------|------|
| 野生黄芪多少钱 | 60 | 包含"多少钱"(+10) |
| 黄芪价格多少钱一斤 | 70 | 包含"价格"和"多少钱"(+20) |
| 黄芪的功效与作用 | 70 | 包含"功效"和"作用"(+20) |
| 黄芪是什么 | 45 | 包含"是什么"(-5) |
| 黄芪图片 | 45 | 包含"图片"(-5) |
| 黄芪的做法 | 45 | 包含"做法"(-5) |
| 黄芪批发价格 | 70 | 包含"批发"和"价格"(+20) |
| 黄芪厂家直销 | 70 | 包含"厂家"(+10) |

## ⚠️ 注意事项

1. **评分规则需要不断优化**：根据实际使用效果调整
2. **不同行业可能需要不同规则**：考虑支持项目级配置
3. **不要过度依赖评分**：评分只是辅助，最终还需人工判断
4. **兼容性**：确保现有数据在没有商业意图分时也能正常工作（默认50分）


