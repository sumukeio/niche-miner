# 淘宝爬虫功能选项清单

## 📋 功能分类

### ✅ 已实现（Core Features - task050-task060）
- [x] 基础登录和 Cookie 持久化
- [x] 基础商品抓取（标题、价格、销量、店铺名、链接）
- [x] 销量过滤（min/max）
- [x] 数据入库到 Supabase
- [x] API 集成和 SSE 实时日志
- [x] 工作流集成

---

## 🎯 功能选项（待决策）

### 分类 1: 账号管理 🆔

#### F1.1 多账号支持
**描述**: 支持管理多个淘宝账号，可以切换使用不同账号进行抓取
**工作量**: 中等（2-3天）
**优先级**: 中
**包含**:
- 账号列表管理（添加、删除、查看）
- 账号信息存储（本地 JSON 或数据库）
- 每个账号独立的 Cookie 存储
- 账号切换功能
- 前端 UI：账号选择下拉框

#### F1.2 账号状态检查
**描述**: 自动检查账号 Cookies 是否有效
**工作量**: 小（0.5天）
**优先级**: 中
**包含**:
- 登录状态验证
- Cookies 有效期检测
- 失效账号标记

#### F1.3 重新登录功能
**描述**: 账号失效时提供快速重新登录入口
**工作量**: 小（0.5天）
**优先级**: 中
**包含**:
- 检测到失效时提示
- 一键重新登录按钮
- 自动更新 Cookies

---

### 分类 2: 商品筛选 🔍

#### F2.1 价格筛选
**描述**: 支持按价格区间筛选商品
**工作量**: 小（0.5天）
**优先级**: 高
**包含**:
- 最小价格、最大价格输入
- 价格筛选开关
- 筛选逻辑实现
- 前端 UI：价格输入框

#### F2.2 关键词筛选（必须包含/不能包含）
**描述**: 支持设置商品标题必须包含或不能包含的关键词
**工作量**: 中等（1-2天）
**优先级**: 高
**包含**:
- "必须包含"关键词列表（AND 关系）
- "不能包含"关键词列表（OR 关系）
- 关键词匹配逻辑
- 前端 UI：关键词输入框（支持添加多个）

#### F2.3 店铺类型筛选
**描述**: 支持筛选 C店/天猫/不限
**工作量**: 小（0.5天）
**优先级**: 中
**包含**:
- 店铺类型识别（通过 URL 或页面元素）
- 筛选逻辑实现
- 前端 UI：单选按钮或下拉框

#### F2.4 其他筛选条件（退货宝、运费险等）
**描述**: 支持更多筛选条件，如退货宝、运费险等标签
**工作量**: 中等（1-2天）
**优先级**: 低
**包含**:
- 页面标签识别
- 筛选条件配置
- 前端 UI：多选框

---

### 分类 3: 错误处理与容错 ⚠️

#### F3.1 验证码处理优化
**描述**: 改进验证码检测和处理流程
**工作量**: 中等（1-2天）
**优先级**: 高
**包含**:
- 更准确的验证码元素检测
- 更友好的用户提示（SSE 消息）
- 超时处理优化（可配置等待时间）
- 验证码处理后自动继续

#### F3.2 售罄商品处理
**描述**: 自动识别并跳过已售罄的商品
**工作量**: 小（0.5天）
**优先级**: 中
**包含**:
- 售罄标识检测（多个选择器）
- 标记为售罄，跳过处理
- 日志记录

#### F3.3 特殊商品处理
**描述**: 识别需要选择款式/规格的商品并跳过
**工作量**: 小（0.5天）
**优先级**: 中
**包含**:
- 特殊商品元素检测
- 标记并跳过
- 日志记录

#### F3.4 网络异常重试机制
**描述**: 实现自动重试机制，处理网络异常
**工作量**: 中等（1天）
**优先级**: 高
**包含**:
- 网络错误检测（超时、连接失败等）
- 自动重试（最多3次）
- 指数退避策略（1s、2s、4s）
- 详细错误日志

#### F3.5 Cookies 失效自动处理
**描述**: 自动检测 Cookies 失效并处理
**工作量**: 小（0.5天）
**优先级**: 高
**包含**:
- 失效检测（重定向到登录页）
- 自动提示用户
- 记录失效账号
- 避免频繁尝试失效账号

---

### 分类 4: 数据提取优化 📊

#### F4.1 商品图片 URL 提取
**描述**: 提取商品的主图 URL 并存储
**工作量**: 小（0.5天）
**优先级**: 中
**包含**:
- 图片 URL 选择器
- 数据提取逻辑
- 数据库字段（已有 `taobao_image_url`）
- 数据入库

#### F4.2 JSON 数据提取（备用方案）
**描述**: 解析页面中的 JavaScript JSON 数据作为备用提取方案
**工作量**: 中等（1-2天）
**优先级**: 低
**包含**:
- 页面 JavaScript 数据定位
- JSON 解析逻辑
- DOM 提取失败时自动切换

#### F4.3 URL 生成优化
**描述**: 直接生成多页搜索 URL，避免重复加载页面
**工作量**: 中等（1天）
**优先级**: 中
**包含**:
- URL 模式分析
- 批量 URL 生成
- 直接访问指定页面（跳过翻页）

#### F4.4 断点续传
**描述**: 支持记录已处理页面，失败后从断点继续
**工作量**: 中等（1-2天）
**优先级**: 低
**包含**:
- 处理进度记录
- 断点保存和恢复
- 任务状态管理

---

### 分类 5: 反爬增强 🛡️

#### F5.1 IP 代理支持
**描述**: 支持配置 IP 代理池，轮换使用降低风控风险
**工作量**: 大（3-5天）
**优先级**: 低
**包含**:
- 代理池管理
- 代理配置（环境变量或配置文件）
- 代理轮换逻辑
- 代理失效检测和切换
- Playwright 代理配置

#### F5.2 Cookies 代理池
**描述**: 维护多个账号 Cookies，轮换使用降低单账号请求频率
**工作量**: 中等（2-3天）
**优先级**: 低
**包含**:
- 多账号 Cookies 管理
- 轮换使用逻辑
- 自动切换账号

---

### 分类 6: 数据库扩展 💾

#### F6.1 数据库 Schema 扩展
**描述**: 添加新的数据字段（图片 URL、店铺信息等）
**工作量**: 小（0.5天）
**优先级**: 中
**包含**:
- `taobao_image_url` 字段
- `taobao_shop_name` 字段
- `taobao_shop_type` 字段
- 数据库迁移脚本

---

### 分类 7: 用户体验优化 🎨

#### F7.1 筛选条件保存
**描述**: 保存常用的筛选条件配置，方便重复使用
**工作量**: 中等（1-2天）
**优先级**: 低
**包含**:
- 筛选配置保存（本地或数据库）
- 配置名称和描述
- 配置加载和应用

#### F7.2 抓取统计和报告
**描述**: 显示抓取统计信息（成功数、失败数、过滤数等）
**工作量**: 中等（1-2天）
**优先级**: 低
**包含**:
- 实时统计更新
- 统计信息展示
- 导出报告（可选）

---

## 📊 工作量统计

### 工作量估算（天）
- **小** (S): 0.5 天
- **中等** (M): 1-2 天
- **大** (L): 3-5 天

### 优先级建议
- **高**: 核心功能，影响用户体验的关键问题
- **中**: 增强功能，提升体验和稳定性
- **低**: 优化功能，可根据实际需求决定

---

## 🎯 推荐实现顺序

### 第一阶段（核心增强）
1. **F3.1** 验证码处理优化 - 高优先级，影响使用
2. **F3.4** 网络异常重试机制 - 高优先级，提升稳定性
3. **F3.5** Cookies 失效自动处理 - 高优先级，用户体验
4. **F2.1** 价格筛选 - 高优先级，常用功能

### 第二阶段（功能扩展）
5. **F2.2** 关键词筛选 - 高优先级，提升筛选能力
6. **F3.2** 售罄商品处理 - 中优先级，优化数据质量
7. **F3.3** 特殊商品处理 - 中优先级，优化数据质量
8. **F4.1** 商品图片 URL 提取 - 中优先级，数据完整性

### 第三阶段（高级功能）
9. **F1.1** 多账号支持 - 中优先级，根据需求
10. **F2.3** 店铺类型筛选 - 中优先级
11. **F6.1** 数据库 Schema 扩展 - 中优先级
12. **F4.3** URL 生成优化 - 中优先级，性能优化

### 第四阶段（可选功能）
13. **F1.2** 账号状态检查 - 中优先级
14. **F1.3** 重新登录功能 - 中优先级
15. **F4.2** JSON 数据提取 - 低优先级
16. **F5.1** IP 代理支持 - 低优先级
17. **F5.2** Cookies 代理池 - 低优先级
18. **F4.4** 断点续传 - 低优先级
19. **F2.4** 其他筛选条件 - 低优先级
20. **F7.1** 筛选条件保存 - 低优先级
21. **F7.2** 抓取统计和报告 - 低优先级

---

## 💡 决策建议

### 快速迭代方案（推荐）
选择第一阶段 + 部分第二阶段功能：
- F3.1, F3.4, F3.5, F2.1, F2.2, F3.2, F3.3, F4.1
- **总工作量**: 约 7-10 天
- **价值**: 核心功能完善，用户体验大幅提升

### 完整方案
选择所有高优先级和中优先级功能：
- 第一阶段 + 第二阶段 + 第三阶段
- **总工作量**: 约 15-20 天
- **价值**: 功能完整，可应对各种场景

### 最小方案
只选择高优先级功能：
- F3.1, F3.4, F3.5, F2.1, F2.2
- **总工作量**: 约 4-6 天
- **价值**: 快速解决核心问题

---

## 📝 下一步

1. **决策**: 选择要实现的功能（可以告诉我功能编号，如 F3.1, F3.4, F2.1）
2. **拆解**: 我将根据选择的功能拆解成具体的 Task（task061, task062...）
3. **开发**: 按照 Task 顺序逐步实现

